{"version":3,"sources":["../../src/pages/update-profile/update-profile.module.ts","../../src/pages/update-profile/update-profile.ts"],"names":[],"mappings":"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","file":"3.main.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\nimport { TranslateModule } from '@ngx-translate/core';\r\nimport { UpdateProfilePage } from './update-profile';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    UpdateProfilePage,\r\n  ],\r\n  imports: [\r\n    IonicPageModule.forChild(UpdateProfilePage),\r\n    TranslateModule.forChild()\r\n  ],\r\n  exports: [\r\n    UpdateProfilePage\r\n  ]\r\n})\r\nexport class UpdateProfilePageModule { }\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/update-profile/update-profile.module.ts","import { Component } from '@angular/core';\r\nimport { IonicPage, NavController, NavParams, ActionSheetController } from 'ionic-angular';\r\nimport { AuthProvider, NetworkProvider, DatabaseProvider, LoadingProvider, StorageProvider, AlertProvider, TranslateProvider, UsersApi } from '../../providers';\r\nimport { User } from '../../models/user';\r\nimport * as firebase from 'firebase';\r\nimport { FormBuilder, FormGroup, Validators, ValidatorFn } from '@angular/forms';\r\nimport { Keyboard } from '@ionic-native/keyboard';\r\nimport { Camera } from '@ionic-native/camera';\r\nimport { Subscription } from 'rxjs/Subscription';\r\n\r\n@IonicPage()\r\n@Component({\r\n  selector: 'page-update-profile',\r\n  templateUrl: 'update-profile.html',\r\n})\r\nexport class UpdateProfilePage {\r\n  private user: User;\r\n  private subscription: Subscription;\r\n  private profileForm: FormGroup;\r\n  private nameValidator: ValidatorFn = Validators.compose([\r\n    Validators.required\r\n  ]);\r\n  private emailValidator: ValidatorFn = Validators.compose([\r\n    Validators.required,\r\n    Validators.email\r\n  ]);\r\n  private phoneValidator: ValidatorFn = Validators.compose([\r\n    Validators.required,\r\n  ]);\r\n  private profilePic: string;\r\n  private loaded: boolean;\r\n\r\n  private defaultImg: string = 'assets/images/profile.png';\r\n  constructor(public navCtrl: NavController,\r\n    public navParams: NavParams,\r\n    private auth: AuthProvider,\r\n    private network: NetworkProvider,\r\n    private database: DatabaseProvider,\r\n    private loading: LoadingProvider,\r\n    private storage: StorageProvider,\r\n    private alert: AlertProvider,\r\n    private translate: TranslateProvider,\r\n    private usersApi: UsersApi,\r\n    private formBuilder: FormBuilder,\r\n    private keyboard: Keyboard,\r\n    private camera: Camera,\r\n    private actionSheetCtrl: ActionSheetController) {\r\n    this.profileForm = this.formBuilder.group({\r\n      firstName: ['', this.nameValidator],\r\n      lastName: ['', this.nameValidator],\r\n      email: ['', this.emailValidator],\r\n      phone:['', this.phoneValidator]\r\n    });\r\n    this.profileForm.get('email').disable();\r\n  }\r\n\r\n  ionViewDidLoad() {\r\n    this.auth.getUser().then((user: firebase.User) => {\r\n      if (!this.subscription) {\r\n        //Subscribe to changes made to the user.\r\n        this.subscription = this.usersApi.subscriptions.get(user.uid).subscribe((user: User) => {\r\n          this.user = user;\r\n          this.profilePic = user.profilePic;\r\n          //Set values to form.\r\n          this.profileForm.setValue({\r\n            firstName: this.user.firstName,\r\n            lastName: this.user.lastName,\r\n            email: this.user.email,\r\n            phone:this.user.phone\r\n          });\r\n        });\r\n      }\r\n\r\n      this.user = this.usersApi.getCurrentUser();\r\n      this.profilePic = this.user.profilePic;\r\n      //Set values to form.\r\n      this.profileForm.setValue({\r\n        firstName: this.user.firstName,\r\n        lastName: this.user.lastName,\r\n        email: this.user.email,\r\n       phone:this.user.phone\r\n      });\r\n    });\r\n  }\r\n\r\n  ionViewWillLeave() {\r\n    if (this.subscription)\r\n      this.subscription.unsubscribe();\r\n  }\r\n\r\n  keyDownFunction(event) {\r\n    if (event.keyCode == 13) {\r\n      this.keyboard.close();\r\n      if (this.profileForm.valid)\r\n        this.updateProfile();\r\n    }\r\n  }\r\n\r\n  private back(): void {\r\n    if (this.user.profilePic != this.defaultImg && this.profilePic == this.defaultImg) {\r\n      this.storage.deleteProfilePic(this.user.userId, this.user.profilePic).then(() => {\r\n        this.user.profilePic = this.defaultImg;\r\n      });\r\n    } else if (this.user.profilePic == this.defaultImg && this.profilePic != this.defaultImg) {\r\n      this.user.profilePic = this.profilePic;\r\n    }\r\n    this.navCtrl.pop();\r\n  }\r\n\r\n  private updateProfile(): void {\r\n    this.loading.show();\r\n    this.user.firstName = this.profileForm.value['firstName'];\r\n    this.user.lastName = this.profileForm.value['lastName'];\r\n    this.database.setUser(this.user).then(() => {\r\n      this.loading.hide();\r\n      this.profilePic = this.user.profilePic;\r\n      this.alert.showAlert(this.translate.get('PROFILE_UPDATED'), this.translate.get('PROFILE_UPDATED_MESSAGE'), this.translate.get('OK')).then(() => { });\r\n    }).catch((error) => {\r\n    });\r\n  }\r\n\r\n  private setProfilePic(): void {\r\n    this.actionSheetCtrl.create({\r\n      title: this.translate.get('SET_PROFILE_PICTURE'),\r\n      buttons: [\r\n        {\r\n          text: this.translate.get('TAKE_A_PHOTO'),\r\n          role: 'destructive',\r\n          handler: () => {\r\n            this.storage.uploadProfilePic(this.user.userId, this.camera.PictureSourceType.CAMERA).then(profilePic => {\r\n              if (this.user.profilePic != this.profilePic) {\r\n                this.storage.deleteProfilePic(this.user.userId, this.user.profilePic).then(() => {\r\n                  this.user.profilePic = profilePic;\r\n                });\r\n              } else {\r\n                this.user.profilePic = profilePic;\r\n              }\r\n            });\r\n          }\r\n        },\r\n        {\r\n          text: this.translate.get('CHOOSE_FROM_GALLERY'),\r\n          handler: () => {\r\n            this.storage.uploadProfilePic(this.user.userId, this.camera.PictureSourceType.PHOTOLIBRARY).then(profilePic => {\r\n              if (this.user.profilePic != this.profilePic) {\r\n                this.storage.deleteProfilePic(this.user.userId, this.user.profilePic).then(() => {\r\n                  this.user.profilePic = profilePic;\r\n                });\r\n              } else {\r\n                this.user.profilePic = profilePic;\r\n              }\r\n            });\r\n          }\r\n        },\r\n        {\r\n          text: this.translate.get('CANCEL'),\r\n          role: 'cancel',\r\n          handler: () => {\r\n          }\r\n        }\r\n      ]\r\n    }).present();\r\n  }\r\n\r\n  private removeProfilePic(): void {\r\n    if (this.profilePic == this.defaultImg) {\r\n      this.storage.deleteProfilePic(this.user.userId, this.user.profilePic).then(() => {\r\n        this.user.profilePic = this.profilePic;\r\n      });\r\n    } else {\r\n      this.user.profilePic = this.defaultImg;\r\n    }\r\n  }\r\n\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/update-profile/update-profile.ts"],"sourceRoot":""}